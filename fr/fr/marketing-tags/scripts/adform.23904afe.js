(function(){"use strict";if(/@|%40/.test(document.location.href))return!1;const n={...window.utag_data?JSON.parse(JSON.stringify(window.utag_data)):{},get country(){return window.location.pathname.split("/")[1]},get language(){return window.location.pathname.split("/")[2]},get site_level_1(){return window.location.pathname.split("/")[3]},get site_level_2(){return window.location.pathname.split("/")[4]}},s={id:null,currency:null,domain:null,prefix:"OWFE - ",_qvsec:10,version:20220607,countryInfo:{at:["1400689","EUR",0],be:["1479431","EUR",0],de:["1400627","EUR",0],ch:["1400700","CHF",0],cz:["1400692","CZK",0],dk:["1479439","DKK",0],es:["1479443","EUR",0],fi:["1479434","EUR",0],fr:["1479429","EUR",0],gb:["1542206","GBP",0],hr:["1542277","EUR",0],hu:["1400703","HUF",0],ie:["1542208","EUR",0],it:["1479440","EUR",0],nl:["1479441","EUR",0],no:["1400672","NOK",0],pl:["1542209","PLN",0],pt:["1479442","EUR",0],ro:["1542270","RON",0],rs:["1542274","RSD",0],ru:["1542341","RUB",0],se:["1400684","SEK",0],si:["2286872","EUR",0],sk:["1400709","EUR",0],ua:["1542279","UAH",0],au:["1542263","AUD",1],in:["1567744","INR",1],jp:["1479448","JPY",1],kr:["1587111","KRW",1],ca:["1678617","CAD",2],us:["1400618","USD",2]},domainLookUp:{0:"track.adform.net",1:"asia.adform.net",2:"a2.adform.net"},pagename:{ADD_TO_CART:"Add to Basket",ADD_TO_WISHLIST:"Add to Wishlist",PIP_VIEW:"Product Page",WISHLIST:"Wishlist",SEARCH:"Search",STOCKCHECK:"Stock Check",CART:"My Basket",CHECKOUT:"Begin Checkout",ORDERCONF:"Checkout(Thank You Page)",HOME_PAGE:"Home Page",ROOMS:"Rooms",CATEGORY_PAGE:"Category Page"},get step_lookup(){let e={};return e[this.pagename.PIP_VIEW]=1,e[this.pagename.ADD_TO_CART]=2,e[this.pagename.CART]=2,e[this.pagename.CHECKOUT]=2,e[this.pagename.ADD_TO_WISHLIST]=2,e[this.pagename.WISHLIST]=2,e[this.pagename.ORDERCONF]=3,e},init:function(e,o,r,i){try{this.id=o||this.countryInfo[e][0],this.currency=r||this.countryInfo[e][1],this.domain=i||this.domainLookUp[this.countryInfo[e][2]],this.eid=this.countryInfo[e][3]?this.getCookie("guest"):null}catch(t){console.error(`issue with adform pixel initialisation: ${t}`)}},sendEvent:function(e,o,r){!r&&r!==""&&(r=this.prefix);let i=[`pm=${this.id}`,"ADFdivider=|",`ADFPageName=${r+e}`,`itm=${encodeURIComponent(JSON.stringify(o))}`];return new Image().src=`https://${this.domain}/Serving/TrackPoint/?${i.join("&")}`},getTotalQuantity:function(e=[]){return e.length?e.reduce((o,{quantity:r=1})=>Number(o)+Number(r),0):1},getItmsArr:function(e=[],o,r){let i=[];for(const t of e){let c={};o&&(c.step=o),t.id?c.pid=t.id:t.item_number_event&&(c.pid=t.item_number_event),t.name&&(c.pnm=t.name),t.product_quantity?c.pcnt=t.product_quantity:t.quantity&&(c.pcnt=t.quantity),t.category&&(c.cid=t.category),t.category_local&&(c.pgr=t.category_local),!r&&t.price&&(c.psl=t.price),i.push(c)}return i},trackEventCB:function(e,o,r=this.prefix){window.addEventListener(e,({detail:i})=>{let t=o(i);t&&this.sendEvent(t,null,r)})},trackCheckout:function(e,o,r=this.prefix,i=void 0){window.addEventListener(e,({detail:t})=>{if(t.name==="checkout_progress"&&t.event_label!=="cart_view")return;let c=!1,a=t?.params?.items||[],u={cntr:n?.country||n?.visit_country,cur:t?.params?.currency||n?.currency_code||n?.currency||this.currency,bsz:this.getTotalQuantity(a)};t.name==="checkout_progress"&&t.event_label==="cart_view"?u.sl=t?.custom?.cart_value:t.name==="begin_checkout"?c=!0:(t.name==="purchase"||t.event_action==="purchase")&&(u.sl=t?.custom?.cart_value||t?.params?.value||t?.custom?.value,u.id=t?.params?.transaction_id);let l={checkout_progress:this.pagename.CART,begin_checkout:this.pagename.CHECKOUT,purchase:this.pagename.ORDERCONF};i||(i=l[t.name]),u.itms=this.getItmsArr(a,this.step_lookup[l[t.name]],c),o&&u.itms.forEach(o),this.sendEvent(i,u,r)})},trackStockcheck:function(e=this.prefix,o=this.pagename.STOCKCHECK){window.addEventListener("pip_page_actions",({detail:r})=>{if(r.event_action!=="stock_check_click")return;let i={cntr:n?.country||n?.visit_country,cur:n?.currency_code||n?.currency||this.currency,sv1:r?.custom?.stock_check_store_id},t=this._dlProdInfo(n).prod;i.itms=this.getItmsArr([t]),this.sendEvent(o,i,e)})},trackSearch:function(e=this.prefix,o=this.pagename.SEARCH){window.addEventListener("search_box",({detail:r})=>{if(r.event_action!=="hard_search")return;let i={sv2:r.event_label};this.sendEvent(o,i,e)})},trackAddToCart:function(e,o=this.prefix,r=this.pagename.ADD_TO_CART){window.addEventListener("add_to_cart",({detail:i})=>{let t={cntr:n?.country||n?.visit_country,cur:i?.params?.currency||n?.currency_code||n?.currency||this.currency},c=i?.params?.items;if(i.event_label==="pip"){let a=this._dlProdInfo(n);c=[{...c,...a.prod}],t={...t,...a.itm}}t.itms=this.getItmsArr(c,this.step_lookup[this.pagename.ADD_TO_CART]),e&&t.itms.forEach(e),this.sendEvent(r,t,o)})},trackAddToWishlist:function(e,o=this.prefix,r=this.pagename.ADD_TO_WISHLIST){window.addEventListener("ecommerce",({detail:i})=>{if(i?.event_action!=="add_to_wishlist")return;let t={cntr:n?.country||n?.visit_country,cur:n?.currency_code||n?.currency||this.currency},c=i?.custom;if(i.event_label==="pip"){let a=this._dlProdInfo(n);c={...c,...a.prod},t={...t,...a.itm}}t.itms=this.getItmsArr([c],this.step_lookup[this.pagename.ADD_TO_WISHLIST]),e&&t.itms.forEach(e),this.sendEvent(r,t,o)})},sendPipView:function(e,o=this.prefix,r=this.pagename.PIP_VIEW){let i={cntr:n?.country||n?.visit_country,cur:n?.currency_code||n?.currency||this.currency},t=this._dlProdInfo(n).prod;i={...this._dlProdInfo(n).itm},i.itms=this.getItmsArr([t],this.step_lookup[this.pagename.PIP_VIEW]),e&&i.itms.forEach(e),this.sendEvent(r,i,o)},trackWishlist:function(e,o=this.prefix,r=this.pagename.WISHLIST){window.addEventListener("ecommerce",({detail:i})=>{if(i.event_action!=="view_list")return;let t={cntr:n?.country||n?.visit_country,cur:n?.currency_code||n?.currency||this.currency},c=[],a=i?.custom?.item_number_event.split(",")||[],u=i?.custom?.product_quantity.split(",")||[];a.forEach((l,d)=>{c.push({id:l,quantity:u[d]})}),t.itms=this.getItmsArr(c,this.step_lookup[this.pagename.WISHLIST]),e&&t.itms.forEach(e),this.sendEvent(r,t,o)})},_dlProdInfo:function(e){return{prod:{category_local:e?.category_local?.toLowerCase(),category:e?.category,name:e?.product_names?.join(),id:e?.product_ids?.[0],price:e?.price?.[0]},itm:{sv3:e?.hfb_no,sv4:e?.hfb_name,sv5:e?.pra_no,sv6:e?.pra_name,sv7:e?.pa_no,sv8:e?.pa_name}}},trackLocal:function(){if(window._adfLocal)window._adfLocal(this,n);else{let e=()=>{window?._adfLocal?.(this,n),window.removeEventListener("_adfLocalLoaded",e)};window.addEventListener("_adfLocalLoaded",e)}},trackQualityVisit:function(){this.trackQVSeconds(this._qvsec),this._trackPageScroll()},_getScrollPercentage:function(){let e=window.innerHeight||(document.documentElement||document.body).clientHeight,o=this._getDocumentHeight(),r=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop,i=o-e;return Math.floor(r/i*100)},_getDocumentHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},_trackPageScroll:function(){let e=!1;window.addEventListener("scroll",()=>{e||this._getScrollPercentage()>49&&(e=!0,this.sendEvent("Quality visit"))})},trackQVSeconds:function(e,o){e=e||this._qvsec,o=o||`Quality Visit - ${e} seconds active session`;const r=`adf_qv_counter_${e}`;let i=Number(sessionStorage.getItem(r));if(i>e)return;let t=setInterval(()=>{i==e&&(this.sendEvent(o,null,"IKEA "),clearInterval(t)),i++},1e3);window.addEventListener("beforeunload",()=>sessionStorage.setItem(r,i))},getCookie:function(e){return document.cookie.split(";").reduce((o,r)=>{let[i,t]=r.split("=");return o[i.trim()]=decodeURIComponent(t),o},{})[e]}};s.init(n.country),s.trackSearch(),s.trackAddToCart(),s.trackAddToWishlist(),s.trackStockcheck(),n.page_name==="home page"?s.sendEvent(s.pagename.HOME_PAGE,{cntr:n.country}):n.site_level_1==="rooms"?s.sendEvent(`${s.pagename.ROOMS} - ${n.site_level_2?.replace(/-/g," ")||"no name"}`,{cntr:n.country}):n.site_level_1==="cat"?s.sendEvent(`${s.pagename.CATEGORY_PAGE} - ${n.site_level_2?.replace(/-/g," ")||"no name"}`,{cntr:n.country}):n.site_level_1==="ikea-business"?s.sendEvent(`${s.pagename.ROOMS} - Business Solutions - ${n.site_level_2?.replace(/-/g," ")||"no name"}`,{cntr:n.country}):n.page_type==="product information page"?s.sendPipView():location.pathname.match("/favourites/")?s.trackWishlist():window.Checkout&&(s.trackCheckout("checkout_progress"),s.trackCheckout("begin_checkout"),s.trackCheckout("purchase")),s.trackQualityVisit(),s.trackLocal()})();
